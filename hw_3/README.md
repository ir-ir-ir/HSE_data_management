# Лабораторная работа №3

Вариант 13 (стр 26-28)

Задания лабораторной работы выполненны в PostgreSQL

## Описание схемы базы данных

Состоит из 4-х таблиц:

- machinist
  | id | surname | depot | tax |
  |----|---------|-------|-----|
- locomotive
  | id | trademark | train_parking | depreciation_charges |
  |----|-----------|---------------|----------------------|
- cargo
  | id | cargo_name | price | warehouse | maximum_number |
  |----|------------|-------|-----------|----------------|
- train_ride
  | number | date | machinist_id | locomotive_id | cargo_id | quantity | sum_of_money |
  |--------|------|--------------|---------------|----------|----------|--------------|

  
Для каждой таблицы первый столбец является первичным ключом. Таблица train_ride, по мимо первичного ключа number, содержит три внешних ключа: machinist_id, locomotive_id, cargo_id.

## Задание 1

*Формулировка: Дана схема базы данных в виде следующих отношений.  С помощью операторов SQL создать логическую структуру соответствующих таблиц для хранения в СУБД, используя известные средства поддержания целостности (NOT NULL, UNIQUE, и т.д.). Обосновать выбор типов данных и используемые средства поддержания целостности. При выборе подходящих типов данных использовать информацию о конкретных значениях полей БД (см. прил.1)*


Для первичных ключей буду использовать в качеcтве типа данных serial. Это позволит задать автоматическое увеличение значения первичного ключа, первый id будет задаваться 1, во всех таблицах id как раз начинаются с 1.

**Создание таблицы machinist**

- id: not null + unique (то есть primary key)
- surname, depot - текстовые поля, не должны быть уникальными, обязательны к заполнению
- tax - целое число от 0 до 100, так как измеряется в %
  
![image](https://github.com/user-attachments/assets/9146d2bd-947f-4b99-84ef-7b9d8813a795)

**Создание таблицы locomotive**

- id: not null + unique (то есть primary key)
- trademark, train_parking - текстовые поля, не должны быть уникальными, обязательны к заполнению
- depreciation_charges - целое число от 0 до 100, так как измеряется в %

![image](https://github.com/user-attachments/assets/6acf4130-df1e-481a-9a55-fe86ebb03f07)

**Создание таблицы cargo**

- id: not null + unique (то есть primary key)
- cargo_name, warehouse - текстовые поля, не должны быть уникальными, обязательны к заполнению
- price - целое число > 0 (цена, исчисляемая в рублях), не должно быть уникальным, обязательно к заполнению
- maximum_number - целое число > 0 (так как это максимальное количество), не должно быть уникальным, обязательно к заполнению

![image](https://github.com/user-attachments/assets/f16a23fc-fbea-49c1-b1b6-d0955ea130ce)

**Создание таблицы train_ride**

- number: not null + unique (то есть primary key)
- date - из исходных данных видно, что это дни недели, поэтому создала свой тип данных. date обязательно к заполнению, не должно быть уникальным
- quantity - целое число > 0 (количество перевезенного груза), обязательно к заполнению, не должно быть уникальным
- sum_of_money -  расчет в рублях, поэтому целое число > 0. Обязательно к заполнению, не должно быть уникальным
- machinist_id, locomotive_id, cargo_id - внешние ключи, обязательны к заполнению, не должны быть уникальными. При удалении в таблицах machinist, locomotive, cargo в таблице train_ride тоже будет произведено удаление. Соответственно, при изменении - изменение в таблице train_ride. Поэтому устанавливается CASCADE.

![image](https://github.com/user-attachments/assets/75b6a5c0-dc3a-45fb-8663-c39e9ebc30df)

![image](https://github.com/user-attachments/assets/6ee0086b-e60c-48c5-952d-d33a43174426)


## Задание №2

*Формулировка: Ввести в ранее созданные таблицы конкретные данные (см. прил. 1). Использовать скрипт-файл из операторов INSERT или вспомогательную утилиту.*

![image](https://github.com/user-attachments/assets/ffe4cbc0-6ea6-47ca-990d-1e9d76d9a9ad)

![image](https://github.com/user-attachments/assets/fb6bd723-d1e1-40ed-add8-6159422af32f)

![image](https://github.com/user-attachments/assets/f561dc44-caf9-4de0-a6b6-98b4715b8e7d)

![image](https://github.com/user-attachments/assets/8b10ffa0-fd34-48bf-8d58-e13eb19bd416)

## Задание №3
*Используя оператор SELECT создать запрос для вывода всех строк каждой таблицы. Проверить правильность ввода. При необходимости произвести коррекцию значений операторами INSERT, UPDATE, DELETE.*

![image](https://github.com/user-attachments/assets/38f4e103-ba0e-48ce-a71b-fb0618c9ccb7)

![image](https://github.com/user-attachments/assets/19187092-4b68-40ce-8f4a-ae1336d76817)

![image](https://github.com/user-attachments/assets/e37b0d2c-77b6-454a-858d-90d9316015fe)

![image](https://github.com/user-attachments/assets/4765ef3d-9068-4166-b948-2566bcfa4972)

## Задание №4

*Создать запросы для вывода:*

*a) названий всех различных депо, где работают машинисты;*

![image](https://github.com/user-attachments/assets/0b2835bc-5dfe-4bf6-8c5f-74bd06820923)

*b) всех различных депо, где расположены грузы вместе с их стоимостью;*

![image](https://github.com/user-attachments/assets/1d722d32-e79b-45ca-9237-94468f2244c1)

*c) всех различных марок локомотивов.*

![image](https://github.com/user-attachments/assets/11fa765a-7f64-4bd5-9426-4be9f7ccbf45)

## Задание №5

*Создать запросы для получения инорфмации о:*

*a) названии и месте расположения грузов, с максимальным количеством менее 10000 единиц;*

![image](https://github.com/user-attachments/assets/12bff1c2-0835-4b8a-9694-2679c5d0bb17)

*b) марках и месте расположении тех локомотивов, которые имеют расходы на аммортизацию более 4% и стоящих в депо “Сортировочная”.Вывести также и размер аммортизации. Отсортировать по нему полученные результаты;*

![image](https://github.com/user-attachments/assets/f8d4691b-b015-4899-81ec-f88b78201084)

*с) фамилиях машинистов, работающих в депо “Московское”.*

![image](https://github.com/user-attachments/assets/9079e63a-3d67-40ec-94a8-3b5e97721c07)

## Задание №6

*Для каждой поездки вывести следующие данные:*

*a) дата, рег.номер, фамилия машиниста, название груза, количество, расчетная плата. Отсортировать по фамилии и возрасатнию платы;*

![image](https://github.com/user-attachments/assets/00a13f91-ebf6-44a8-ae3d-4123267ad323)

*b) дату, марку локомотива, название груза.*

![image](https://github.com/user-attachments/assets/62e63a15-5be5-4161-bfa6-594ddd2900d1)

## Задание №7

*Вывести:*

*a) фамилии машинистов, которые работали на локомотивах других депо с расходами на аммортизацию от 4% и выше. Включить в отчет названия этих депо;*

![image](https://github.com/user-attachments/assets/0b7b7bcb-9374-438d-aa0f-bfc6a29848a7)

*b) название  и стоимость груза, складируемого в том же депо, где работает перевозящий груз машинист;*

![image](https://github.com/user-attachments/assets/3b645bfd-4e99-4549-97a5-13ecc23e8a95)

*с) название груза, перевозимого разными машинистами в количестве более 10 единиц;*

![image](https://github.com/user-attachments/assets/00af067e-5c15-4744-a38e-8e3e61566549)

*d) марки локомотивов, на которых производились поездки с расчетной суммой более 100000руб.*
 
![image](https://github.com/user-attachments/assets/21921b52-3b32-49eb-821e-42eea2093e1f)

## Задание №8

*Создать запрос для модификации всех значений столбца с расчетной суммой таблицы поездки, чтобы он содержал истинную сумму, получаемую машинистом ( с учетом налога). Вывести новые значения.*

![image](https://github.com/user-attachments/assets/70bca6e5-8701-443a-b7c7-27a85183ae2b)

## Задание №9



## Задание №10
## Задание №11
## Задание №12
## Задание №13
## Задание №14
## Задание №15
